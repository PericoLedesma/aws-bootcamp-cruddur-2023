#! /usr/bin/bash   

# Parameters
mydatabase='cruddur'

# Code

CYAN='\033[1;36m'
NO_COLOR='\033[0m'
LABEL="run db-displaydata"
printf "${CYAN}== ${LABEL}${NO_COLOR}\n"

ABS_PATH=$(readlink -f "$0")
DB_PATH=$(dirname $ABS_PATH)
BIN_PATH=$(dirname $DB_PATH)
BACKEND_FLASK_PATH=$(dirname $BIN_PATH)
PROJECT_PATH=$(dirname $BACKEND_FLASK_PATH)


if [ "$1" = "prod" ]; then
  echo "Running in production mode"
  URL=$PROD_CONNECTION_URL
else
  echo "Running in local mode"
  URL=$CONNECTION_URL
fi

seed_path="$PROJECT_PATH/bin/db/displaydata.sql"

<<comment

NO_DB_CONNECTION_URL=$(sed 's/\/cruddur//g' <<<"$URL")
databases=$(psql $NO_DB_CONNECTION_URL  -c "SELECT datname FROM pg_database;")


<<comment
# Print the list of databases
echo "List of databases:"
echo "$databases"

echo " "

# Check if 'mydatabase' is in the list of databases
if [[ "$databases" == *"$mydatabase"* ]]; then
    echo "->Database 'cruddur' found! -> Displaying tables"
    echo " "
    psql $URL $mydatabase < $seed_path
else
    echo "Database 'cruddur' not found."
fi

comment