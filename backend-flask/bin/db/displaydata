#! /usr/bin/bash   


# Parameters
mydatabase='cruddur'

# Code

CYAN='\033[1;36m'
NO_COLOR='\033[0m'
LABEL="run db-displaydata"
printf "${CYAN}== ${LABEL}${NO_COLOR}\n"


if [ "$1" = "prod" ]; then
  echo "Running in production mode"
  URL=$PROD_CONNECTION_URL
else
  echo "Running in local mode"
  URL=$CONNECTION_URL
fi

seed_path="$(realpath .)/db/displaydata.sql"

NO_DB_CONNECTION_URL=$(sed 's/\/cruddur//g' <<<"$CONNECTION_URL")
databases=$(psql $NO_DB_CONNECTION_URL  -c "SELECT datname FROM pg_database;")

# Print the list of databases
echo "List of databases:"
echo "$databases"

echo " "

# Check if 'mydatabase' is in the list of databases
if [[ "$databases" == *"$mydatabase"* ]]; then
    echo "->Database 'cruddur' found! -> Displaying tables"
    echo " "
    psql $URL $mydatabase < $seed_path
else
    echo "Database 'cruddur' not found."
fi
